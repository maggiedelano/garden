<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="https://www.maggiedelano.com/obsidian-vs-roam-for-running-book-clubs" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="Obsidian vs. Roam For Running Book ClubsThis is a version of a note I wrote in our shared Obsidian vault as part of Dan Allosso’s Obsidian Book Club on the D...">

  <meta property="og:site_name" content="Maggie Delano's Digital Garden">

  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/garden/styles.css">

  
  <meta property="og:description" content="Obsidian vs. Roam For Running Book ClubsThis is a version of a note I wrote in our shared Obsidian vault as part of Dan Allosso’s Obsidian Book Club on the D..."/>
  

  
  <meta property="og:title" content="Obsidian vs. Roam For Running Book Clubs">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2022-01-21T20:49:21-05:00">
  <meta property="article:author" content="https://www.maggiedelano.com/">
  

  <meta property="og:url" content="https://www.maggiedelano.com/obsidian-vs-roam-for-running-book-clubs" />

  

  <title>
    
      Obsidian vs. Roam For Running Book Clubs &mdash; Maggie Delano's Digital Garden
    
  </title>

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Obsidian vs. Roam For Running Book Clubs | Maggie Delano’s Digital Garden</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Obsidian vs. Roam For Running Book Clubs" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Obsidian vs. Roam For Running Book Clubs This is a version of a note I wrote in our shared Obsidian vault as part of Dan Allosso’s Obsidian Book Club on the Dawn of Everything by David Graeber and David Wengrow. I’m removing comments from others just because I don’t have their permission to share them. I’m focused here specifically on the tools, not so much how the specific book club was run." />
<meta property="og:description" content="Obsidian vs. Roam For Running Book Clubs This is a version of a note I wrote in our shared Obsidian vault as part of Dan Allosso’s Obsidian Book Club on the Dawn of Everything by David Graeber and David Wengrow. I’m removing comments from others just because I don’t have their permission to share them. I’m focused here specifically on the tools, not so much how the specific book club was run." />
<link rel="canonical" href="https://www.maggiedelano.com/garden/obsidian-vs-roam-for-running-book-clubs" />
<meta property="og:url" content="https://www.maggiedelano.com/garden/obsidian-vs-roam-for-running-book-clubs" />
<meta property="og:site_name" content="Maggie Delano’s Digital Garden" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-21T20:49:21-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Obsidian vs. Roam For Running Book Clubs" />
<meta name="twitter:site" content="@maggied" />
<script type="application/ld+json">
{"headline":"Obsidian vs. Roam For Running Book Clubs","dateModified":"2021-12-18T09:55:23-05:00","datePublished":"2022-01-21T20:49:21-05:00","url":"https://www.maggiedelano.com/garden/obsidian-vs-roam-for-running-book-clubs","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.maggiedelano.com/garden/obsidian-vs-roam-for-running-book-clubs"},"description":"Obsidian vs. Roam For Running Book Clubs This is a version of a note I wrote in our shared Obsidian vault as part of Dan Allosso’s Obsidian Book Club on the Dawn of Everything by David Graeber and David Wengrow. I’m removing comments from others just because I don’t have their permission to share them. I’m focused here specifically on the tools, not so much how the specific book club was run.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <nav><div>
    <a class="internal-link" href="/garden/"><b>Maggie Delano's Digital Garden</b></a>
</div>
</nav>
    <div class="wrapper">
      <main><article>
  <div>
    <h1>Obsidian vs. Roam For Running Book Clubs</h1>
    <time datetime="2021-12-18T09:55:23-05:00">
      Last updated on December 18, 2021
      
    </time>
  </div>

  <div id="table-of-contents">
    
  </div>

  <div id="notes-entry-container">
    <content>
      <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h1 id="obsidian-vs-roam-for-running-book-clubs">Obsidian vs. Roam For Running Book Clubs</h1>
<p>This is a version of a note I wrote in our shared Obsidian vault as part of Dan Allosso’s <a href="https://danallosso.substack.com/p/obsidian-book-club-the-dawn-of-everything" target="_blank">Obsidian Book Club</a> on the <em>Dawn of Everything</em> by David Graeber and David Wengrow. I’m removing comments from others just because I don’t have their permission to share them. I’m focused here specifically on the tools, not so much how the specific book club was run.</p>

<h2 id="obsidian-has-more-challenges-getting-started-with-multiplayer">Obsidian has more challenges getting started with multiplayer</h2>
<p>I’m starting with the friction points because this is what you tend to notice at the start of the club, but there are plenty of advantages discussed in the next section!</p>

<h3 id="lack-of-user-specific-customization">Lack of user specific customization</h3>
<p>There is a lack of individual customization of vaults, requiring “shell” vault for your own customization to not influence other people. In Roam you can choose which settings apply to everyone or only certain people, for example a standard CSS that can be modified by individuals (though javascript always has to be opted into for security reasons). This is very easy for new users because the organizers choose the defaults and the user can leave it alone (unless they want to use custom functionality).</p>

<p>Also, the other issue is that given everyone is sharing the same <code class="language-plaintext highlighter-rouge">.obsidian</code> folder, <strong>anyone</strong> can change the settings for <strong>everyone</strong>, which makes it difficult to have strong defaults for new users, which would be nice.</p>

<h3 id="lack-of-clear-landing-page">Lack of clear landing page</h3>
<p>There is no “landing page” or shared sidebar, compared with the shared sidebar in Roam and the daily notes page as a landing page. One potential solution to this is to use the <a href="https://github.com/mirnovov/obsidian-homepage" target="_blank">Homepage</a> plugin or starred notes, but we did not try it in the first Obsidian book club.</p>

<h3 id="difficulty-using-the-same-page-at-the-same-time">Difficulty using the same page at the same time</h3>
<p>It can be fun in Roam to all write together on the same page. This works well and sort of like a Google doc so long as you don’t have too many users at the same time (like over 100). This is not really possible in Obsidian with the Dropbox merge conflicts. The Dropbox merge conflicts also come up sometimes when someone is just viewing a file, even if they don’t actively edit it. This could be an issue with Dropbox rather than Obsidian though.</p>

<h3 id="lack-of-user-sandbox">Lack of user sandbox</h3>
<p>It’s a little harder to isolate people’s personal notes from one another because in Obsidian it makes sense to work with a folder of atomic notes not a single personal page like in Roam. This means we could have a dozen “Chapter 1” notes which is kind of annoying. I recommend using a prefix or suffix in personal notes as Dan and I have done e.g. <code class="language-plaintext highlighter-rouge">[[MKD Journal]]</code>.</p>

<h3 id="hard-to-see-whats-been-updated-recently">Hard to see what’s been updated recently</h3>
<p>This is something that Roam has issues with as well (easily seeing what has changed since you last visited), but you can handle this easily in Roam by linking to the Daily Notes Page, which is the first thing that shows up when a user signs in to the graph. With all the comments distributed throughout the vault, this is likely an issue. The way we got around this in the book club was using the <a href="https://github.com/badrbouslikhin/obsidian-vault-changelog" target="_blank">Changelog</a> plugin. This worked well, but because it runs only on one person’s computer it is not “always on.” Each person could set up their own instance in their shell vault if they wanted to, though.</p>

<h3 id="hard-to-link-files-to-other-people-especially-when-using-shell-vault">Hard to link files to other people, especially when using shell vault</h3>
<p>There isn’t an easily available and consistent URL you can link to like you can in Roam. This mostly comes up in live discussions where you want to make reference to a specific note or block. You can use <code class="language-plaintext highlighter-rouge">obsidian://</code> links, but these are tied to a vault, so everyone would have to name their book club shells the same thing for them to work. Another alternative is to use the Dropbox URL, or you just paste the wikilink and the other person pastes that in and clicks it.</p>

<h2 id="obsidian-may-encourage-more-contribution-to-shared-knowledge">Obsidian May Encourage More Contribution to Shared Knowledge</h2>

<h3 id="obsidian-is-faster-and-easier-for-browsing-and-organization">Obsidian is faster and easier for browsing and organization</h3>
<p>Especially with the addition of folders, Obsidian is much easier to browse and navigate because it’s much clearer what it is in there. It is also much easier to avoid overwhelm by realizing the root folder is getting out of control and creating homes for notes organically. Roam can be kind of a black hole and needs to be structured carefully for things not to get lost.</p>

<h3 id="obsidian-encourages-writing-in-prose">Obsidian encourages writing in prose</h3>
<p>As Obsidian is not an outliner (unlike Roam), it encourages you to write in prose. This helps make your future notes much more organized, but has the trade off that it can be harder to organize complex concepts or notes with a lot of content (though folding and the outline view in the side panel helps a lot).</p>

<p>Possibly because Obsidian encourages you to write in prose, it seems much more feasible to me for multiple people to easily contribute to a shared knowledge base. In Roam Book Club we often turn on a feature called immutable blocks, which prevents users from editing blocks created by other users. This was necessary because people would unintentionally delete the work of others, and Roam only has hourly backups. Dropbox seems better suited to handling potential lost information, so long as the merge conflicts are not so bad.</p>

<h3 id="obsidian-has-a-better-graph-view">Obsidian has a better graph view</h3>
<p>The graph view allows one to easily see which pages have not been created, for example, which you could then consider populating.</p>

<h3 id="page-back-links-in-obsidian-do-not-create-files">Page back links in Obsidian do not create files</h3>
<p>This is really nice because you can find pages that have been linked to but are not created yet in the <code class="language-plaintext highlighter-rouge">[[</code> menu or using the Graph view, but they do not clutter up the file explorer. In Roam Book Club, we have to ban people from creating their own pages for the first few weeks because it becomes too much of a mess, especially because pages are case sensitive (unlike in Obsidian). Another reason for this is because Roam treats pages and tags the same. I did not use tags in Obsidian much, so anyone using them did not interfere with me, and those tags can also easily be namespaced to not be too disruptive.</p>

<h3 id="file-portability">File Portability</h3>
<p>One other advantage of Obsidian is that these markdown files are very easy to export and save later. This means they can easily be backed up to personal vaults or moved to future vaults. You can do this in Roam but it requires exporting, and if you don’t use name spaces it’s a pain in the butt to get all the files you want. (I guess this is the same constraint as using folders, though).</p>

<h2 id="overall-thoughts">Overall Thoughts</h2>
<p>I think Obsidian has a lot of promise especially if the goal is to attempt to create a shared knowledge base. Care should be taken to help onboard new users, especially given that the best experience in Obsidian is more dependent on plugins and customization compared with Roam.</p>

<p>I’ve been impressed with how much people have been able to organically contribute to the vault structure so far, and also contribute to notes in the Glossary etc., without many hiccups that I can tell. One consideration is that this book is very different from the books we’ve read in Roam Book Club so far, so it’s possible we’d get that sort of engagement reading this book too, but I think it’s easier to jump in in Obsidian. People are sometimes afraid of “messing things up” in Roam.</p>
</body></html>

    </content>

    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      

      <div style="font-size: 0.9em">
        <p>
          There are no notes linking to this note.
        </p>
      </div>
      
    </side>
  </div>
</article>

<hr>

<p>Here are all the notes in this garden, along with their links, visualized as a graph.</p>

<style>
  .links line {
    stroke: #ccc;
    opacity: 0.5;
  }

  .nodes circle {
    cursor: pointer;
    fill: #8b88e6;
    transition: all 0.15s ease-out;
  }

  .text text {
    cursor: pointer;
    fill: #333;
    text-shadow: -1px -1px 0 #fafafabb, 1px -1px 0 #fafafabb, -1px 1px 0 #fafafabb, 1px 1px 0 #fafafabb;
  }

  .nodes [active],
  .text [active] {
    cursor: pointer;
    fill: black;
  }

  .inactive {
    opacity: 0.1;
    transition: all 0.15s ease-out;
  }

  #graph-wrapper {
    background: #fcfcfc;
    border-radius: 4px;
    height: auto;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
  integrity="sha512-FHsFVKQ/T1KWJDGSbrUhTJyS1ph3eRrxI228ND0EGaEp6v4a/vGwPWd3Dtd/+9cI7ccofZvl/wulICEurHN1pg=="
  crossorigin="anonymous"></script>

<div id="graph-wrapper">
  <script>
    const MINIMAL_NODE_SIZE = 8;
    const MAX_NODE_SIZE = 12;
    const ACTIVE_RADIUS_FACTOR = 1.5;
    const STROKE = 1;
    const FONT_SIZE = 16;
    const TICKS = 200;
    const FONT_BASELINE = 40;
    const MAX_LABEL_LENGTH = 50;

    const graphData = {"edges":[{"source":"3382923595264944459053140","target":"35785895735030"},{"source":"83980740473741404","target":"75519512887172167793552"},{"source":"4264560724020553976","target":"75519512887172167793552"},{"source":"83980740473741404","target":"81626248081932234102743"},{"source":"83980740473741404","target":"48598160581454072"},{"source":"4264560724020553976","target":"48598160581454072"},{"source":"75519512887172167793552","target":"83980740473741404"},{"source":"81626248081932234102743","target":"83980740473741404"},{"source":"48598160581454072","target":"83980740473741404"},{"source":"3738869998546123535","target":"83980740473741404"},{"source":"4264560724020553976","target":"83980740473741404"},{"source":"48598160581454072","target":"3738869998546123535"},{"source":"83980740473741404","target":"3738869998546123535"},{"source":"4264560724020553976","target":"3738869998546123535"},{"source":"81626248081932234102743","target":"4264560724020553976"},{"source":"48598160581454072","target":"4264560724020553976"},{"source":"83980740473741404","target":"4264560724020553976"},{"source":"3738869998546123535","target":"4264560724020553976"},{"source":"48598160581454072","target":"4578679678735461989859"},{"source":"81626248081932234102743","target":"3642613618311825137"},{"source":"48598160581454072","target":"3642613618311825137"},{"source":"3738869998546123535","target":"3642613618311825137"},{"source":"4264560724020553976","target":"3642613618311825137"},{"source":"82936483322276","target":"3642613618311825137"},{"source":"317603515401676197658131903166","target":"3642613618311825137"},{"source":"83980740473741404","target":"82936483322276"}],"nodes":[{"id":"342448303611429250356031845664485098319048","path":"/garden/broader-impacts-at-neurips-2020","label":"Broader Impacts at NeurIPS 2020"},{"id":"35785895735030","path":"/garden/contact-me","label":"Contact Me"},{"id":"3382923595264944459053140","path":"/garden/favorite-problems","label":"Favorite Problems"},{"id":"2290959712372494700","path":"/garden/helpful-books","label":"Helpful Books"},{"id":"15073327635460299847868890644548652117623","path":"/garden/inclusive-engineering-design","label":"Inclusive Engineering Design"},{"id":"75519512887172167793552","path":"/garden/capture-workflow","label":"Capture Workflow"},{"id":"81626248081932234102743","path":"/garden/daily-reflection","label":"Daily Reflection"},{"id":"48598160581454072","path":"/garden/daily-review","label":"Daily Review"},{"id":"83980740473741404","path":"/garden/my-workflows","label":"My Workflows"},{"id":"3738869998546123535","path":"/garden/semester-plan","label":"Semester Plan"},{"id":"4264560724020553976","path":"/garden/weekly-review","label":"Weekly Review"},{"id":"1540914265625259245170472890527046506037737803638984","path":"/garden/obsidian-vs-roam-for-running-book-clubs","label":"Obsidian vs. Roam For Running Book Clubs"},{"id":"4578679678735461989859","path":"/garden/quantified-self","label":"Quantified Self"},{"id":"3642613618311825137","path":"/garden/roam-research","label":"Roam Research"},{"id":"233959746474886049326429588","path":"/garden/teaching-resources","label":"Teaching Resources"},{"id":"82936483322276","path":"/garden/tech-stack","label":"Tech Stack"},{"id":"531179896518317482849376723342341022","path":"/garden/unsolicited-career-advice","label":"Unsolicited Career Advice"},{"id":"317603515401676197658131903166","path":"/garden/using-custom-js-in-roam","label":"Using Custom JS in Roam"}]}
    let nodesData = graphData.nodes;
    let linksData = graphData.edges;

    const nodeSize = {};

    const updateNodeSize = () => {
      nodesData.forEach((el) => {
        let weight =
          3 *
          Math.sqrt(
            linksData.filter((l) => l.source === el.id || l.target === el.id)
              .length + 1
          );
        if (weight < MINIMAL_NODE_SIZE) {
          weight = MINIMAL_NODE_SIZE;
        } else if (weight > MAX_NODE_SIZE) {
          weight = MAX_NODE_SIZE;
        }
        nodeSize[el.id] = weight;
      });
    };

    const onClick = (d) => {
      window.location = d.path
    };

    const onMouseover = function (d) {
      const relatedNodesSet = new Set();
      linksData
        .filter((n) => n.target.id == d.id || n.source.id == d.id)
        .forEach((n) => {
          relatedNodesSet.add(n.target.id);
          relatedNodesSet.add(n.source.id);
        });

      node.attr("class", (node_d) => {
        if (node_d.id !== d.id && !relatedNodesSet.has(node_d.id)) {
          return "inactive";
        }
        return "";
      });

      link.attr("class", (link_d) => {
        if (link_d.source.id !== d.id && link_d.target.id !== d.id) {
          return "inactive";
        }
        return "";
      });

      link.attr("stroke-width", (link_d) => {
        if (link_d.source.id === d.id || link_d.target.id === d.id) {
          return STROKE * 4;
        }
        return STROKE;
      });
      text.attr("class", (text_d) => {
        if (text_d.id !== d.id && !relatedNodesSet.has(text_d.id)) {
          return "inactive";
        }
        return "";
      });
    };

    const onMouseout = function (d) {
      node.attr("class", "");
      link.attr("class", "");
      text.attr("class", "");
      link.attr("stroke-width", STROKE);
    };

    const sameNodes = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const map = new Map();
      for (const node of previous) {
        map.set(node.id, node.label);
      }

      for (const node of next) {
        const found = map.get(node.id);
        if (!found || found !== node.title) {
          return false;
        }
      }

      return true;
    };

    const sameEdges = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const set = new Set();
      for (const edge of previous) {
        set.add(`${edge.source.id}-${edge.target.id}`);
      }

      for (const edge of next) {
        if (!set.has(`${edge.source}-${edge.target}`)) {
          return false;
        }
      }

      return true;
    };

    const graphWrapper = document.getElementById('graph-wrapper')
    const element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    element.setAttribute("width", graphWrapper.getBoundingClientRect().width);
    element.setAttribute("height", window.innerHeight * 0.8);
    graphWrapper.appendChild(element);

    const reportWindowSize = () => {
      element.setAttribute("width", window.innerWidth);
      element.setAttribute("height", window.innerHeight);
    };

    window.onresize = reportWindowSize;

    const svg = d3.select("svg");
    const width = Number(svg.attr("width"));
    const height = Number(svg.attr("height"));
    let zoomLevel = 1;

    const simulation = d3
      .forceSimulation(nodesData)
      .force("forceX", d3.forceX().x(width / 2))
      .force("forceY", d3.forceY().y(height / 2))
      .force("charge", d3.forceManyBody())
      .force(
        "link",
        d3
          .forceLink(linksData)
          .id((d) => d.id)
          .distance(70)
      )
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(80))
      .stop();

    const g = svg.append("g");
    let link = g.append("g").attr("class", "links").selectAll(".link");
    let node = g.append("g").attr("class", "nodes").selectAll(".node");
    let text = g.append("g").attr("class", "text").selectAll(".text");

    const resize = () => {
      if (d3.event) {
        const scale = d3.event.transform;
        zoomLevel = scale.k;
        g.attr("transform", scale);
      }

      const zoomOrKeep = (value) => (zoomLevel >= 1 ? value / zoomLevel : value);

      const font = Math.max(Math.round(zoomOrKeep(FONT_SIZE)), 1);

      text.attr("font-size", (d) => font);
      text.attr("y", (d) => d.y - zoomOrKeep(FONT_BASELINE) + 8);
      link.attr("stroke-width", zoomOrKeep(STROKE));
      node.attr("r", (d) => {
        return zoomOrKeep(nodeSize[d.id]);
      });
      svg
        .selectAll("circle")
        .filter((_d, i, nodes) => d3.select(nodes[i]).attr("active"))
        .attr("r", (d) => zoomOrKeep(ACTIVE_RADIUS_FACTOR * nodeSize[d.id]));

      document.getElementById("zoom").innerHTML = zoomLevel.toFixed(2);
    };

    const ticked = () => {
      node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
      text
        .attr("x", (d) => d.x)
        .attr("y", (d) => d.y - (FONT_BASELINE - nodeSize[d.id]) / zoomLevel);
      link
        .attr("x1", (d) => d.source.x)
        .attr("y1", (d) => d.source.y)
        .attr("x2", (d) => d.target.x)
        .attr("y2", (d) => d.target.y);
    };

    const restart = () => {
      updateNodeSize();
      node = node.data(nodesData, (d) => d.id);
      node.exit().remove();
      node = node
        .enter()
        .append("circle")
        .attr("r", (d) => {
          return nodeSize[d.id];
        })
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(node);

      link = link.data(linksData, (d) => `${d.source.id}-${d.target.id}`);
      link.exit().remove();
      link = link.enter().append("line").attr("stroke-width", STROKE).merge(link);

      text = text.data(nodesData, (d) => d.label);
      text.exit().remove();
      text = text
        .enter()
        .append("text")
        .text((d) => shorten(d.label.replace(/_*/g, ""), MAX_LABEL_LENGTH))
        .attr("font-size", `${FONT_SIZE}px`)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "central")
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(text);

      node.attr("active", (d) => isCurrentPath(d.path) ? true : null);
      text.attr("active", (d) => isCurrentPath(d.path) ? true : null);

      simulation.nodes(nodesData);
      simulation.force("link").links(linksData);
      simulation.alpha(1).restart();
      simulation.stop();

      for (let i = 0; i < TICKS; i++) {
        simulation.tick();
      }

      ticked();
    };

    const zoomHandler = d3.zoom().scaleExtent([0.2, 3]).on("zoom", resize);

    zoomHandler(svg);
    restart();

    function isCurrentPath(notePath) {
      return window.location.pathname.includes(notePath)
    }

    function shorten(str, maxLen, separator = ' ') {
      if (str.length <= maxLen) return str;
      return str.substr(0, str.lastIndexOf(separator, maxLen)) + '...';
    }
  </script>
</div>
</main>
      <footer>These notes are always evolving. If these interest you, please <a class="internal-link" href="/garden/contact-me">get in touch</a>. You can learn more about me on my <a class="internal-link" href="/">website</a>.
</footer>
    </div>

    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      iframe.src = event.target.href
      iframe.onload = function() {
        tooltipContentHtml = ''
        tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
        tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

        tooltipContent.innerHTML = tooltipContentHtml

        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content a').forEach(setupListeners);
</script>

  </body>
</html>
